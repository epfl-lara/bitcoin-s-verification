\documentclass{beamer}

\usepackage{listings}
\input{solidity-highlighting.tex}

\usecolortheme{beaver}

\AtBeginSection
{
  \begin{frame}
    \frametitle{Table of Contents}
    \tableofcontents[currentsection]
  \end{frame}
}

\setbeamertemplate{itemize items}{\textbullet}
\setbeamertemplate{footline}[text line]{%
  \parbox{\linewidth}{\vspace*{-8pt}
    \insertshorttitle\hfill\insertshortauthor\hfill\insertframenumber
  }
}
\setbeamertemplate{navigation symbols}{}

\begin{document}

\title{Formal Verification in Scala}
% \subtitle{The Decentralized Autonomous Organization}
\author{Ramon Boss, Anna Doukmak}

\date{2019-06-13}

\frame{\titlepage}

\begin{frame}
  \frametitle{Table of Contents}
  \tableofcontents
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Formal Verification Components //TODO: or concept}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
\frametitle{Stainless}
%\begin{columns}
%  \begin{column}{0.5\textwidth}
  %Basics
  \begin{itemize}
    \item Pure Scala
    \item Imperative features // remove?
    \item Pre- and Postcondition
    \item Outcome: valid, invalid, unknown
  \end{itemize}
%  \end{column}
  %\pause
  %\begin{column}{0.5\textwidth}
  %  Technology
  %  \begin{itemize}
  %    \item An open-source software
  %    \item Written in Solidity
  %    \item Build on Ethereum blockchain
  %  \end{itemize}
  %\end{column}
%\end{columns}
\end{frame}


\begin{frame}
\frametitle{Properties to Verify}
\begin{itemize}
  \item Bitcoin-S
  \item No Inflation Property
  \item Addition with Zero Property
\end{itemize}
%\pause
%\begin{lstlisting}[language=Solidity]
%contract DAO is DAOInterface {
%  uint constant minProposalDebatePeriod = 2 weeks;
%  uint public proposalDeposit;
%  mapping (address => bool) public allowedRecipients;

%  function DAO(uint _proposalDeposit) {
%    proposalDeposit = _proposalDeposit;
%    allowedRecipients[address(this)] = true;
%  }
%}
%\end{lstlisting}
\end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Process of Verification //TODO: change the title}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\begin{frame}[fragile]
\frametitle{Verifying No Inflation Property}
\begin{itemize}
  \item Validation of a Transaction with \textit{checkTransaction}
  \item Integration of Stainless
  \item Adjusting the Property
  \item Bug in \textit{checkTransaction}
\end{itemize}
\pause
\begin{lstlisting}[language=Scala]
  val prevOutputTxIds = transaction.inputs.map(_.previousOutput.txId)
  val noDuplicateInputs = prevOutputTxIds.distinct.size == prevOutputTxIds.size
\end{lstlisting}
\end{frame}


\begin{frame}
\frametitle{Bugfix}
\centering
\includegraphics[width=\textwidth,height=0.8\textheight,keepaspectratio]{assets/bitcoin-s-pr.png}
\end{frame}


\begin{frame}[fragile]
\frametitle{Verifying Addition with Zero}
\begin{itemize}%[<1-2>]
  \item Datatype Satoshis
  \item Method for Verification
  \begin{lstlisting}[language=Scala, numbers=none]
    +(c: CurrencyUnit): CurrencyUnit
  \end{lstlisting}
  \item Rewriting 2 Classes in Pure Scala
\end{itemize}
\end{frame}


\begin{frame}
\frametitle{Rewriting the code}
\end{frame}


\begin{frame}[fragile]
\frametitle{Formal Specification}
\begin{lstlisting}[language=Scala]
  override def +(c: CurrencyUnit): CurrencyUnit = {
    require(c.satoshis == Satoshis.zero)
    Satoshis(satoshis.underlying + c.satoshis.underlying)
  } ensuring(res => res.satoshis == this.satoshis)
\end{lstlisting}
\end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Results}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}
\frametitle{Output of Stainless}
\centering
\includegraphics[width=\textwidth,height=0.8\textheight,keepaspectratio]{assets/final_verify_output.png}
\end{frame}


\end{document}
